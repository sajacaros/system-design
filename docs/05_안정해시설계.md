# 5장 안정 해시 설계
## 해시 키 재배치(rehash) 문제
- N개의 캐시 서버에 안정적으로 키를 분배하는 방법
    - `serverIndex = hash(key) % N
    - ![](images/05/t5-1.png)
    - ![](images/05/5-1.png)
- 서버가 추가되거나 기존 서버가 삭제된 경우(server1번이 죽은 경우 가정)
    - 해시값이 고정인 상태로 N만 변경됨
    - ![](images/05/5-2.png)
    - 대부분의 키가 재분배됨
    - 서버 한대가 죽음으로써 대규모 캐시미스 상태가 발생함
    - 이 문제를 효과적으로 해결하는 기술을 안정 해시라고 함
## 안정 해시
* 해시 테이블 크기가 조정 될 때 평균적으로 오직 k/n개의 키만 재배치하는 해시 기술
* 해시 공간과 해시 링
    - ![](images/05/5-3.png)
    - ![](images/05/5-4.png)
* 해시 서버
    - ![](images/05/5-5.png)
* 해시 키
    - ![](images/05/5-6.png)
* 서버 조회
    - ![](images/05/5-7.png)
* 서버 추가
    - ![](images/05/5-8.png)
* 서버 제거
    - ![](images/05/5-9.png)
* 기본 구현법의 두가지 문제
    - 서버가 추가 되거나 삭제되는 상황에서 파티션의 크기를 균등하게 유지하는게 불가능
        - ![](images/05/5-10.png)
    - 키의 균등 분포를 달성하기 어려움
        - ![](images/05/5-11.png)
* 가상 노드
    - 하나의 서버는 링 위에 여러개의 가성 노드를 가질 수 있음
    - ![](images/05/5-12.png)
* 재배치할 키 결정
    - ![](images/05/5-14.png)
    - ![](images/05/5-15.png)